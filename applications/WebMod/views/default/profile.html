{{left_sidebar_enabled,right_sidebar_enabled=False,('message' in globals())}}
{{extend 'layout.html'}}

<head>
{{block header}}
   <ul>
      <li style="float:left"><a href="/WebMod/default/index.html"><b>Webmod 2.0</b></a></li>
      <li style="float:right">
         {{if auth.user_id is None:}}
            {{=A('Sign In', _href=URL('default', 'user', args=['login']))}}
         {{else:}}
            {{=A('My Profile', _href=URL('default', 'profile', args=[auth.user_id]))}}
         {{pass}}
      </li>
      <li style="float:right">
         {{if auth.user_id is None:}}
            {{=A('Sign Up', _href=URL('default', 'user', args=['register']))}}
         {{else:}}
            {{=A('Logout', _href=URL('default', 'user', args='logout'))}}
         {{pass}}
      </li>
   </ul>
{{end}}
</head>

<body style="background: linear-gradient(#212229, #000000);">
   <div id="target"></div>
</body>

{{block footer}}  
  <footer class="footer" style="background-color:#0d0d0d;">
      <div class="container-fluid" style="color:#d98200; text-align:center;">
         Webmod 2.0
      </div>
   </footer>
{{end}}

<script id="template" type="text/ractive">
   
   <div class="orange_btn" onclick="models()" style="float:right;">{{=user['username']}}'s Models</div>
   <div class="orange_btn" onclick="favs()" style="float:right;">{{=user['username']}}'s Favorites</div>
   
   <table style="width:100%;">
      <tr>
         <td colspan="2">
            <h2>Profile</h2>
         </td>
         <td colspan="3">
            <h2>Most Popular Models</h2>
         </td>
      </tr>
      <tr>
         <td colspan="2">
            <div style="height:450px; background:#111; border-radius:5px;-webkit-box-shadow:0 0 10px #d98200; -moz-box-shadow: 0 0 10px #d98200; box-shadow:0 0 10px #d98200;">
               {{if user['image'] == '':}}
                  <img src="{{=URL('static','images/default-avatar.png')}}" style="padding-left:20px; padding-top:20px; float:left;" width="200px" height="200px"/>
               {{else:}}
                  <img src="{{=URL('default', 'download', args=user['image'])}}" style="padding-left:20px; padding-top:20px; float:left;" width="200px" height="200px"/>
               {{pass}}
               {{if int(request.args(0)) == int(auth.user_id):}}
                  {{=A('Edit Profile', _class='orange_btn', _style='float:right;', _href=URL('default', 'user', args='profile'))}}<br>
               {{pass}}
               <div style="padding-left:20px; padding-right:20px; color:white; float:left;">
                  <h2>{{=user['username']}}</h2><br>
                  {{if int(request.args(0)) == int(auth.user_id):}}
                     Name: {{=user['first_name']}} {{=user['last_name']}}<br>
                     Email: {{=user['email']}}<br><br>
                  {{pass}}
                  Has created {{=user['model_popularity']}} favorited models<br>
                  Has favorited {{=user['num_favorites']}} models<br>
               </div>
            </div>
         </td>
         {% #model_fav_dict:model_id %}
            <td colspan="1">
               <div class="inner">
                  <h3>{% name %}</h3><br>
                  {% description %}<br><br>
                  <i class="fa fa-heart" style="color:#ff3333;"></i> Favorited {%num_favorites%} Times<br>
                  <div style="color:gray;">
                     <i>created by: {{=user['username']}}</i><br>
                     {% #if isPublic === true %}
                        Public,
                     {% /if %}
                     {% #if isPublic === false %}
                        Private,
                     {% /if %}
                     {% #if isShareable === true %}
                        YAY Sharing<br>
                     {% /if %}
                     {% #if isShareable === false %}
                        No Sharing<br>
                     {% /if %}
                  </div>
                  <img id="dynImg" src="{% thumbnail_image %}" width="200px" height="200px"></img>
               <div>
            </td>
         {% /model_fav_dict %}
      </tr>
      
      <tr>
         <td colspan="5"><h2>All Models</h2></td>
      </tr> 
      
      <tr>
         {% #model_dict:thing %}
            <td colspan="1">
               <div class="inner">
                  <h3>{% name %}</h3><br>
                  {% description %}<br><br>
                  <i class="fa fa-heart" style="color:#ff3333;"></i> Favorited {%num_favorites%} Times<br>
                  <div style="color:gray;">
                     <i>created by: {{=user['username']}}</i><br>
                     {% #if isPublic === true %}
                        Public,
                     {% /if %}
                     {% #if isPublic === false %}
                        Private,
                     {% /if %}
                     {% #if isShareable === true %}
                        YAY Sharing<br>
                     {% /if %}
                     {% #if isShareable === false %}
                        No Sharing<br>
                     {% /if %}
                  </div>
                  <img id="dynImg" src="{% thumbnail_image %}" width="200px" height="200px"></img>
               <div>
            </td>
         {% /model_dict %}
      </tr>
 
      <tr>
         <td colspan="5"><h2></h2></td>
      </tr>
   </table>
   
   {% #if !noMore %}
      <div class="orange_btn" on-click="showMore" style="float:right;">Show Next 5 Models</div>
   {% /if %}
   {% #if !noPrev %}
      <div class="orange_btn" on-click="showPrev" style="float:right;">Show Previous 5 Models</div>
   {% /if %}
   
</script>   

<script>
   $(function() {

      // Ractive object
      var MAIN = new Ractive({
         el: '#target',
         template: '#template',
         delimiters: ['{%', '%}'],
         tripleDelimiters: ['{%%', '%%}'],
         data: {
            fav: false,  //is the user looking at that profiles models, or that profile's favorites
            model_dict: {},
            model_fav_dict: {},
            fav_dict: {},
            showing_row: 0,
            profile_id:"{{=user['id']}}",
            noMore: true,
            noPrev: true,
         },
      });
   
      $.ajax("{{=URL('default', 'load_models')}}",
      {
         data: {
            profile_id: MAIN.get('profile_id'),
            row: MAIN.get('showing_row')
         },
         method: 'POST',
         success: function(data){
            MAIN.set('model_dict', data['model_dict']);
            var buffer = MAIN.get('model_dict');
            var index = 0;
            for (var m in buffer){
                  index = index + 1;
            }
            if( index < 4){
               MAIN.set('noMore', true);
            }
            else{
               MAIN.set('noMore', false);
            }
               }
      });
      
      $.ajax("{{=URL('default', 'load_fav_models')}}",
      {
         data: {
            profile_id: MAIN.get('profile_id')
         },
         method: 'POST',
         success: function(data){
            MAIN.set('model_fav_dict', data['model_fav_dict'])
         }
      });
      
      function models(){
         if(MAIN.get('fav') == true)
            MAIN.set('fav', false);
         return;
      }
      
      function favs(){
         if(MAIN.get('fav') == false)
            MAIN.set('fav', true);
         return;
      }
      
      MAIN.on('showMore', function(e){
         if (MAIN.get('noMore') == false){
            MAIN.set('showing_row',(MAIN.get('showing_row') + 1));
            $.ajax("{{=URL('default', 'load_models')}}",
            {
               data: {
                  profile_id: MAIN.get('profile_id'),
                  row: MAIN.get('showing_row')
               },
               method: 'POST',
               success: function(data){
                  MAIN.set('model_dict', data['model_dict']);
                  var buffer = MAIN.get('model_dict');
                  var index = 0;
                  for (var m in buffer){
                     index = index + 1;
                  }
                  if (index <= 5){
                     MAIN.set('noMore', true);
                  }
                  MAIN.set('noPrev', false);
               }
            });
         }
      });
      
      MAIN.on("showPrev", function(e){
         if (MAIN.get('noPrev') == false){
            MAIN.set('showing_row',(MAIN.get('showing_row') - 1));
            $.ajax("{{=URL('default', 'load_models')}}",
            {
               data: {
                  profile_id: MAIN.get('profile_id'),
                  row: MAIN.get('showing_row')
               },
               method: 'POST',
               success: function(data){
                  MAIN.set('model_dict', data['model_dict']);
                  if(MAIN.get('showing_row') == '0'){
                     MAIN.set('noPrev', true);
                  }
                  var buffer = MAIN.get('model_dict');
                  var index = 0;
                  for (var m in buffer){
                        index = index + 1;
                  }
                  if( index < 4){
                     MAIN.set('noMore', true);
                  }
                  else{
                     MAIN.set('noMore', false);
                  }
               }
            });
         }
      });
   });
</script>